#!/bin/bash -e

CONFIG=${CONFIG:-/etc/marketcetera/strategyagent.conf}
[ -r $CONFIG ] && . $CONFIG

METC_HOME=${METC_HOME:-/usr/share/marketcetera}
SA_DIR=${SA_DIR:-${METC_HOME}/strategyagent}
USER_PROPERTIES_FILE="${SA_DIR}/conf/user.properties"
# Determine classpath needed to run apps
CLASSPATH=${SA_DIR}/conf
for jar in `ls -1 ${METC_HOME}/lib/*.jar`; do
  CLASSPATH=$CLASSPATH:$jar
done

ACTIVEMQ_PORT=${ACTIVEMQ_PORT:-61619}
ORS_HOST=${ORS_HOST:-localhost}
ORS_PORT=${ORS_PORT:-61618}
cat > $USER_PROPERTIES_FILE << EOF
metc.sa.ws.host=localhost
metc.sa.ws.port=9001
metc.sa.recv.url=tcp://localhost:${ACTIVEMQ_PORT}
metc.sa.client.URL=tcp://${ORS_HOST}:${ORS_PORT}
EOF

WORKDIR=${WORKDIR:-`pwd`}
cd $WORKDIR
JAVA=`which java`
exec $JAVA -Xms384m -Xmx600m -XX:MaxPermSize=512m -server -Dorg.marketcetera.appDir=${SA_DIR} -cp $CLASSPATH org.marketcetera.strategyagent.StrategyAgent $* 2>&1
